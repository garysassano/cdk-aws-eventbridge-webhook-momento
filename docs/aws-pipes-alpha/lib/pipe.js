"use strict";
var _a;
Object.defineProperty(exports, "__esModule", { value: true });
exports.Pipe = exports.DesiredState = void 0;
const jsiiDeprecationWarnings = require("../.warnings.jsii.js");
const JSII_RTTI_SYMBOL_1 = Symbol.for("jsii.rtti");
const aws_cdk_lib_1 = require("aws-cdk-lib");
const aws_iam_1 = require("aws-cdk-lib/aws-iam");
const aws_pipes_1 = require("aws-cdk-lib/aws-pipes");
const logs_1 = require("./logs");
/**
 * The state the pipe should be in.
 */
var DesiredState;
(function (DesiredState) {
    /**
     * The pipe should be running.
     */
    DesiredState["RUNNING"] = "RUNNING";
    /**
     * The pipe should be stopped.
     * */
    DesiredState["STOPPED"] = "STOPPED";
})(DesiredState || (exports.DesiredState = DesiredState = {}));
class PipeBase extends aws_cdk_lib_1.Resource {
}
/**
 * An imported pipe.
 */
class ImportedPipe extends PipeBase {
    constructor(scope, id, pipeName) {
        super(scope, id);
        this.pipeName = pipeName;
        this.pipeArn = aws_cdk_lib_1.Stack.of(this).formatArn({
            service: 'pipes',
            partition: 'aws',
            resource: 'pipe',
            resourceName: this.pipeName,
        });
        this.pipeRole = aws_iam_1.Role.fromRoleName(this, 'Role', this.pipeName);
    }
}
/**
 * Amazon EventBridge Pipes connects sources to targets.
 *
 * Pipes are intended for point-to-point integrations between supported sources and targets,
 * with support for advanced transformations and enrichment.
 *
 * @see https://docs.aws.amazon.com/eventbridge/latest/userguide/eb-pipes.html
 */
class Pipe extends PipeBase {
    /**
     * Creates a pipe from the name of a pipe.
     */
    static fromPipeName(scope, id, pipeName) {
        return new ImportedPipe(scope, id, pipeName);
    }
    constructor(scope, id, props) {
        super(scope, id, { physicalName: props.pipeName });
        try {
            jsiiDeprecationWarnings._aws_cdk_aws_pipes_alpha_PipeProps(props);
        }
        catch (error) {
            if (process.env.JSII_DEBUG !== "1" && error.name === "DeprecationError") {
                Error.captureStackTrace(error, Pipe);
            }
            throw error;
        }
        /**
         * Role setup
         */
        this.pipeRole =
            props.role ||
                new aws_iam_1.Role(this, 'Role', {
                    assumedBy: new aws_iam_1.ServicePrincipal('pipes.amazonaws.com'),
                });
        /**
         * Source / Filter setup
         */
        const source = props.source.bind(this);
        props.source.grantRead(this.pipeRole);
        // Add the filter criteria to the source parameters
        const sourceParameters = {
            ...source.sourceParameters,
            filterCriteria: props.filter,
        };
        /**
         * Enrichment setup
         */
        const enrichment = props.enrichment?.bind(this);
        props.enrichment?.grantInvoke(this.pipeRole);
        /**
         * Target setup
         */
        const target = props.target.bind(this);
        props.target.grantPush(this.pipeRole);
        /**
         * Logs setup
         */
        const initialLogConfiguration = {
            level: props.logLevel || logs_1.LogLevel.ERROR,
            includeExecutionData: props.logIncludeExecutionData || undefined,
        };
        // Iterate over all the log destinations and add them to the log configuration
        const logConfiguration = props.logDestinations?.reduce((currentLogConfiguration, destination) => {
            const logDestinationConfig = destination.bind(this);
            destination.grantPush(this.pipeRole);
            const additionalLogConfiguration = logDestinationConfig.parameters;
            return { ...currentLogConfiguration, ...additionalLogConfiguration };
        }, initialLogConfiguration);
        /**
         * Pipe resource
         */
        const resource = new aws_pipes_1.CfnPipe(this, 'Resource', {
            name: props.pipeName,
            description: props.description,
            roleArn: this.pipeRole.roleArn,
            source: props.source.sourceArn,
            sourceParameters: sourceParameters,
            enrichment: props.enrichment?.enrichmentArn,
            enrichmentParameters: enrichment?.enrichmentParameters,
            target: props.target.targetArn,
            targetParameters: target.targetParameters,
            desiredState: props.desiredState,
            logConfiguration: logConfiguration,
            tags: props.tags,
        });
        this.pipeName = resource.ref;
        this.pipeArn = resource.attrArn;
    }
}
exports.Pipe = Pipe;
_a = JSII_RTTI_SYMBOL_1;
Pipe[_a] = { fqn: "@aws-cdk/aws-pipes-alpha.Pipe", version: "2.155.0-alpha.0" };
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoicGlwZS5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzIjpbInBpcGUudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6Ijs7Ozs7O0FBQUEsNkNBQXlEO0FBQ3pELGlEQUFvRTtBQUNwRSxxREFBZ0Q7QUFJaEQsaUNBQXlFO0FBa0N6RTs7R0FFRztBQUNILElBQVksWUFVWDtBQVZELFdBQVksWUFBWTtJQUN0Qjs7T0FFRztJQUNILG1DQUFtQixDQUFBO0lBRW5COztTQUVLO0lBQ0wsbUNBQW1CLENBQUE7QUFDckIsQ0FBQyxFQVZXLFlBQVksNEJBQVosWUFBWSxRQVV2QjtBQW1IRCxNQUFlLFFBQVMsU0FBUSxzQkFBUTtDQUt2QztBQUVEOztHQUVHO0FBQ0gsTUFBTSxZQUFhLFNBQVEsUUFBUTtJQUtqQyxZQUFZLEtBQWdCLEVBQUUsRUFBVSxFQUFFLFFBQWdCO1FBQ3hELEtBQUssQ0FBQyxLQUFLLEVBQUUsRUFBRSxDQUFDLENBQUM7UUFDakIsSUFBSSxDQUFDLFFBQVEsR0FBRyxRQUFRLENBQUM7UUFDekIsSUFBSSxDQUFDLE9BQU8sR0FBRyxtQkFBSyxDQUFDLEVBQUUsQ0FBQyxJQUFJLENBQUMsQ0FBQyxTQUFTLENBQUM7WUFDdEMsT0FBTyxFQUFFLE9BQU87WUFDaEIsU0FBUyxFQUFFLEtBQUs7WUFDaEIsUUFBUSxFQUFFLE1BQU07WUFDaEIsWUFBWSxFQUFFLElBQUksQ0FBQyxRQUFRO1NBQzVCLENBQUMsQ0FBQztRQUNILElBQUksQ0FBQyxRQUFRLEdBQUcsY0FBSSxDQUFDLFlBQVksQ0FBQyxJQUFJLEVBQUUsTUFBTSxFQUFFLElBQUksQ0FBQyxRQUFRLENBQUUsQ0FBQztLQUNqRTtDQUNGO0FBRUQ7Ozs7Ozs7R0FPRztBQUNILE1BQWEsSUFBSyxTQUFRLFFBQVE7SUFDaEM7O09BRUc7SUFDSCxNQUFNLENBQUMsWUFBWSxDQUFDLEtBQWdCLEVBQUUsRUFBVSxFQUFFLFFBQWdCO1FBRWhFLE9BQU8sSUFBSSxZQUFZLENBQUMsS0FBSyxFQUFFLEVBQUUs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QixDQUFDLENBQUM7UUFFSCxJQUFJLENBQUMsUUFBUSxHQUFHLFFBQVEsQ0FBQyxHQUFHLENBQUM7UUFDN0IsSUFBSSxDQUFDLE9BQU8sR0FBRyxRQUFRLENBQUMsT0FBTyxDQUFDO0tBQ2pDOztBQXRGSCxvQkF3RkMiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBJUmVzb3VyY2UsIFJlc291cmNlLCBTdGFjayB9IGZyb20gJ2F3cy1jZGstbGliJztcbmltcG9ydCB7IElSb2xlLCBSb2xlLCBTZXJ2aWNlUHJpbmNpcGFsIH0gZnJvbSAnYXdzLWNkay1saWIvYXdzLWlhbSc7XG5pbXBvcnQgeyBDZm5QaXBlIH0gZnJvbSAnYXdzLWNkay1saWIvYXdzLXBpcGVzJztcbmltcG9ydCB7IENvbnN0cnVjdCB9IGZyb20gJ2NvbnN0cnVjdHMnO1xuaW1wb3J0IHsgSUVucmljaG1lbnQgfSBmcm9tICcuL2VucmljaG1lbnQnO1xuaW1wb3J0IHsgSUZpbHRlciB9IGZyb20gJy4vZmlsdGVyJztcbmltcG9ydCB7IElMb2dEZXN0aW5hdGlvbiwgSW5jbHVkZUV4ZWN1dGlvbkRhdGEsIExvZ0xldmVsIH0gZnJvbSAnLi9sb2dzJztcbmltcG9ydCB7IElTb3VyY2UgfSBmcm9tICcuL3NvdXJjZSc7XG5pbXBvcnQgeyBJVGFyZ2V0IH0gZnJvbSAnLi90YXJnZXQnO1xuXG4vKipcbiAqIEludGVyZmFjZSByZXByZXNlbnRpbmcgYSBjcmVhdGVkIG9yIGFuIGltcG9ydGVkIGBQaXBlYC5cbiAqL1xuZXhwb3J0IGludGVyZmFjZSBJUGlwZSBleHRlbmRzIElSZXNvdXJjZSB7XG4gIC8qKlxuICAgKiBUaGUgbmFtZSBvZiB0aGUgcGlwZS5cbiAgICpcbiAgICogQGF0dHJpYnV0ZVxuICAgKiBAbGluayBodHRwczovL2RvY3MuYXdzLmFtYXpvbi5jb20vQVdTQ2xvdWRGb3JtYXRpb24vbGF0ZXN0L1VzZXJHdWlkZS9hd3MtcmVzb3VyY2UtcGlwZXMtcGlwZS5odG1sI2Nmbi1waXBlcy1waXBlLW5hbWVcbiAgICovXG4gIHJlYWRvbmx5IHBpcGVOYW1lOiBzdHJpbmc7XG5cbiAgLyoqXG4gICAqIFRoZSBBUk4gb2YgdGhlIHBpcGUuXG4gICAqXG4gICAqIEBhdHRyaWJ1dGVcbiAgICogQGxpbmsgaHR0cHM6Ly9kb2NzLmF3cy5hbWF6b24uY29tL0FXU0Nsb3VkRm9ybWF0aW9uL2xhdGVzdC9Vc2VyR3VpZGUvYXdzLXJlc291cmNlLXBpcGVzLXBpcGUuaHRtbCNBcm4tZm46OmdldGF0dFxuICAgKi9cbiAgcmVhZG9ubHkgcGlwZUFybjogc3RyaW5nO1xuXG4gIC8qKlxuICAgKiBUaGUgcm9sZSB1c2VkIGJ5IHRoZSBwaXBlLlxuICAgKiBGb3IgaW1wb3J0ZWQgcGlwZXMgaXQgYXNzdW1lcyB0aGF0IHRoZSBkZWZhdWx0IHJvbGUgaXMgdXNlZC5cbiAgICpcbiAgICogQGF0dHJpYnV0ZVxuICAgKi9cbiAgcmVhZG9ubHkgcGlwZVJvbGU6IElSb2xlO1xuXG59XG5cbi8qKlxuICogVGhlIHN0YXRlIHRoZSBwaXBlIHNob3VsZCBiZSBpbi5cbiAqL1xuZXhwb3J0IGVudW0gRGVzaXJlZFN0YXRlIHtcbiAgLyoqXG4gICAqIFRoZSBwaXBlIHNob3VsZCBiZSBydW5uaW5nLlxuICAgKi9cbiAgUlVOTklORyA9ICdSVU5OSU5HJyxcblxuICAvKipcbiAgICogVGhlIHBpcGUgc2hvdWxkIGJlIHN0b3BwZWQuXG4gICAqICovXG4gIFNUT1BQRUQgPSAnU1RPUFBFRCcsXG59XG5cbi8qKlxuICogUHJvcGVydGllcyBmb3IgYSBwaXBlLlxuICovXG5leHBvcnQgaW50ZXJmYWNlIFBpcGVQcm9wcyB7XG4gIC8qKlxuICAgKiBUaGUgc291cmNlIG9mIHRoZSBwaXBlLlxuICAgKlxuICAgKiBAc2VlIGh0dHBzOi8vZG9jcy5hd3MuYW1hem9uLmNvbS9ldmVudGJyaWRnZS9sYXRlc3QvdXNlcmd1aWRlL2ViLXBpcGVzLWV2ZW50LXNvdXJjZS5odG1sXG4gICAqL1xuICByZWFkb25seSBzb3VyY2U6IElTb3VyY2U7XG5cbiAgLyoqXG4gICAqIFRoZSBmaWx0ZXIgcGF0dGVybiBmb3IgdGhlIHBpcGUgc291cmNlXG4gICAqXG4gICAqIEBzZWUgaHR0cHM6Ly9kb2NzLmF3cy5hbWF6b24uY29tL2V2ZW50YnJpZGdlL2xhdGVzdC91c2VyZ3VpZGUvZWItcGlwZXMtZXZlbnQtZmlsdGVyaW5nLmh0bWxcbiAgICogQGRlZmF1bHQgLSBubyBmaWx0ZXJcbiAgICovXG4gIHJlYWRvbmx5IGZpbHRlcj86IElGaWx0ZXI7XG5cbiAgLyoqXG4gICogRW5yaWNobWVudCBzdGVwIHRvIGVuaGFuY2UgdGhlIGRhdGEgZnJvbSB0aGUgc291cmNlIGJlZm9yZSBzZW5kaW5nIGl0IHRvIHRoZSB0YXJnZXQuXG4gICpcbiAgKiBAc2VlIGh0dHBzOi8vZG9jcy5hd3MuYW1hem9uLmNvbS9ldmVudGJyaWRnZS9sYXRlc3QvdXNlcmd1aWRlL3BpcGVzLWVucmljaG1lbnQuaHRtbFxuICAqIEBkZWZhdWx0IC0gbm8gZW5yaWNobWVudFxuICAqL1xuICByZWFkb25seSBlbnJpY2htZW50PzogSUVucmljaG1lbnQ7XG5cbiAgLyoqXG4gICAqIFRoZSB0YXJnZXQgb2YgdGhlIHBpcGVcbiAgICpcbiAgICogQHNlZSBodHRwczovL2RvY3MuYXdzLmFtYXpvbi5jb20vZXZlbnRicmlkZ2UvbGF0ZXN0L3VzZXJndWlkZS9lYi1waXBlcy1ldmVudC10YXJnZXQuaHRtbFxuICAgKi9cbiAgcmVhZG9ubHkgdGFyZ2V0OiBJVGFyZ2V0O1xuXG4gIC8qKlxuICAqIE5hbWUgb2YgdGhlIHBpcGUgaW4gdGhlIEFXUyBjb25zb2xlXG4gICpcbiAgKiBAbGluayBodHRwOi8vZG9jcy5hd3MuYW1hem9uLmNvbS9BV1NDbG91ZEZvcm1hdGlvbi9sYXRlc3QvVXNlckd1aWRlL2F3cy1yZXNvdXJjZS1waXBlcy1waXBlLmh0bWwjY2ZuLXBpcGVzLXBpcGUtbmFtZVxuICAqXG4gICogQGRlZmF1bHQgLSBhdXRvbWF0aWNhbGx5IGdlbmVyYXRlZCBuYW1lXG4gICovXG4gIHJlYWRvbmx5IHBpcGVOYW1lPzogc3RyaW5nO1xuXG4gIC8qKlxuICAgKiBUaGUgcm9sZSB1c2VkIGJ5IHRoZSBwaXBlIHdoaWNoIGhhcyBwZXJtaXNzaW9ucyB0byByZWFkIGZyb20gdGhlIHNvdXJjZSBhbmQgd3JpdGUgdG8gdGhlIHRhcmdldC5cbiAgICogSWYgYW4gZW5yaWNoZWQgdGFyZ2V0IGlzIHVzZWQsIHRoZSByb2xlIGFsc28gaGF2ZSBwZXJtaXNzaW9ucyB0byBjYWxsIHRoZSBlbnJpY2hlZCB0YXJnZXQuXG4gICAqIElmIG5vIHJvbGUgaXMgcHJvdmlkZWQsIGEgcm9sZSB3aWxsIGJlIGNyZWF0ZWQuXG4gICAqXG4gICAqIEBzZWUgaHR0cHM6Ly9kb2NzLmF3cy5hbWF6b24uY29tL2V2ZW50YnJpZGdlL2xhdGVzdC91c2VyZ3VpZGUvZWItcGlwZXMtcGVybWlzc2lvbnMuaHRtbFxuICAgKiBAZGVmYXVsdCAtIGEgbmV3IHJvbGUgd2lsbCBiZSBjcmVhdGVkLlxuICAgKi9cbiAgcmVhZG9ubHkgcm9sZT86IElSb2xlO1xuXG4gIC8qKlxuICAgKiBEZXN0aW5hdGlvbnMgZm9yIHRoZSBsb2dzLlxuICAgKlxuICAgKiBAc2VlIGh0dHBzOi8vZG9jcy5hd3MuYW1hem9uLmNvbS9ldmVudGJyaWRnZS9sYXRlc3QvdXNlcmd1aWRlL2ViLXBpcGVzLWxvZ3MuaHRtbFxuICAgKiBAZGVmYXVsdCAtIG5vIGxvZ3NcbiAgICovXG4gIHJlYWRvbmx5IGxvZ0Rlc3RpbmF0aW9ucz86IElMb2dEZXN0aW5hdGlvbltdO1xuXG4gIC8qKlxuICAgICogVGhlIGxldmVsIG9mIGxvZ2dpbmcgZGV0YWlsIHRvIGluY2x1ZGUuXG4gICAgKlxuICAgICogVGhpcyBhcHBsaWVzIHRvIGFsbCBsb2cgZGVzdGluYXRpb25zIGZvciB0aGUgcGlwZS5cbiAgICAqXG4gICAgKiBAc2VlIGh0dHBzOi8vZG9jcy5hd3MuYW1hem9uLmNvbS9ldmVudGJyaWRnZS9sYXRlc3QvdXNlcmd1aWRlL2ViLXBpcGVzLWxvZ3MuaHRtbFxuICAgICogQGRlZmF1bHQgLSBMb2dMZXZlbC5FUlJPUlxuICAgICovXG4gIHJlYWRvbmx5IGxvZ0xldmVsPzogTG9nTGV2ZWw7XG5cbiAgLyoqXG4gICAgKiBXaGV0aGVyIHRoZSBleGVjdXRpb24gZGF0YSAoc3BlY2lmaWNhbGx5LCB0aGUgYHBheWxvYWRgICwgYGF3c1JlcXVlc3RgICwgYW5kIGBhd3NSZXNwb25zZWAgZmllbGRzKSBpcyBpbmNsdWRlZCBpbiB0aGUgbG9nIG1lc3NhZ2VzIGZvciB0aGlzIHBpcGUuXG4gICAgKlxuICAgICogVGhpcyBhcHBsaWVzIHRvIGFsbCBsb2cgZGVzdGluYXRpb25zIGZvciB0aGUgcGlwZS5cbiAgICAqXG4gICAgKiBGb3IgbW9yZSBpbmZvcm1hdGlvbiwgc2VlIFtJbmNsdWRpbmcgZXhlY3V0aW9uIGRhdGEgaW4gbG9nc10oaHR0cHM6Ly9kb2NzLmF3cy5hbWF6b24uY29tL2V2ZW50YnJpZGdlL2xhdGVzdC91c2VyZ3VpZGUvZWItcGlwZXMtbG9ncy5odG1sI2ViLXBpcGVzLWxvZ3MtZXhlY3V0aW9uLWRhdGEpIGFuZCB0aGUgW21lc3NhZ2Ugc2NoZW1hXShodHRwczovL2RvY3MuYXdzLmFtYXpvbi5jb20vZXZlbnRicmlkZ2UvbGF0ZXN0L3VzZXJndWlkZS9lYi1waXBlcy1sb2dzLXNjaGVtYS5odG1sKSBpbiB0aGUgKkFtYXpvbiBFdmVudEJyaWRnZSBVc2VyIEd1aWRlKiAuXG4gICAgKlxuICAgICogQHNlZSBodHRwOi8vZG9jcy5hd3MuYW1hem9uLmNvbS9BV1NDbG91ZEZvcm1hdGlvbi9sYXRlc3QvVXNlckd1aWRlL2F3cy1wcm9wZXJ0aWVzLXBpcGVzLXBpcGUtcGlwZWxvZ2NvbmZpZ3VyYXRpb24uaHRtbCNjZm4tcGlwZXMtcGlwZS1waXBlbG9nY29uZmlndXJhdGlvbi1pbmNsdWRlZXhlY3V0aW9uZGF0YVxuICAgICogQGRlZmF1bHQgLSBub25lXG4gICAgKi9cbiAgcmVhZG9ubHkgbG9nSW5jbHVkZUV4ZWN1dGlvbkRhdGE/OiBJbmNsdWRlRXhlY3V0aW9uRGF0YVtdO1xuXG4gIC8qKlxuICAgKiBBIGRlc2NyaXB0aW9uIG9mIHRoZSBwaXBlIGRpc3BsYXllZCBpbiB0aGUgQVdTIGNvbnNvbGVcbiAgICpcbiAgICogQHNlZSBodHRwOi8vZG9jcy5hd3MuYW1hem9uLmNvbS9BV1NDbG91ZEZvcm1hdGlvbi9sYXRlc3QvVXNlckd1aWRlL2F3cy1yZXNvdXJjZS1waXBlcy1waXBlLmh0bWwjY2ZuLXBpcGVzLXBpcGUtZGVzY3JpcHRpb25cbiAgICpcbiAgICogQGRlZmF1bHQgLSBubyBkZXNjcmlwdGlvblxuICAgKi9cbiAgcmVhZG9ubHkgZGVzY3JpcHRpb24/OiBzdHJpbmc7XG5cbiAgLyoqXG4gICAqIFRoZSBkZXNpcmVkIHN0YXRlIG9mIHRoZSBwaXBlLiBJZiB0aGUgc3RhdGUgaXMgc2V0IHRvIFNUT1BQRUQsIHRoZSBwaXBlIHdpbGwgbm90IHByb2Nlc3MgZXZlbnRzLlxuICAgKlxuICAgKiBAc2VlIGh0dHBzOi8vZG9jcy5hd3MuYW1hem9uLmNvbS9ldmVudGJyaWRnZS9sYXRlc3QvcGlwZXMtcmVmZXJlbmNlL0FQSV9QaXBlLmh0bWwjZXZlbnRicmlkZ2UtVHlwZS1QaXBlLURlc2lyZWRTdGF0ZVxuICAgKlxuICAgKiBAZGVmYXVsdCAtIERlc2lyZWRTdGF0ZS5SVU5OSU5HXG4gICAqL1xuICByZWFkb25seSBkZXNpcmVkU3RhdGU/OiBEZXNpcmVkU3RhdGU7XG5cbiAgLyoqXG4gICAqIFRoZSBsaXN0IG9mIGtleS12YWx1ZSBwYWlycyB0byBhc3NvY2lhdGUgd2l0aCB0aGUgcGlwZS5cbiAgICpcbiAgICogQHNlZSBodHRwOi8vZG9jcy5hd3MuYW1hem9uLmNvbS9BV1NDbG91ZEZvcm1hdGlvbi9sYXRlc3QvVXNlckd1aWRlL2F3cy1yZXNvdXJjZS1waXBlcy1waXBlLmh0bWwjY2ZuLXBpcGVzLXBpcGUtdGFnc1xuICAgKlxuICAgKiBAZGVmYXVsdCAtIG5vIHRhZ3NcbiAgICovXG4gIHJlYWRvbmx5IHRhZ3M/OiB7XG4gICAgW2tleTogc3RyaW5nXTogc3RyaW5nO1xuICB9O1xufVxuXG5hYnN0cmFjdCBjbGFzcyBQaXBlQmFzZSBleHRlbmRzIFJlc291cmNlIGltcGxlbWVudHMgSVBpcGUge1xuICBwdWJsaWMgYWJzdHJhY3QgcmVhZG9ubHkgcGlwZU5hbWU6IHN0cmluZztcbiAgcHVibGljIGFic3RyYWN0IHJlYWRvbmx5IHBpcGVBcm46IHN0cmluZztcbiAgcHVibGljIGFic3RyYWN0IHJlYWRvbmx5IHBpcGVSb2xlOiBJUm9sZTtcblxufVxuXG4vKipcbiAqIEFuIGltcG9ydGVkIHBpcGUuXG4gKi9cbmNsYXNzIEltcG9ydGVkUGlwZSBleHRlbmRzIFBpcGVCYXNlIHtcbiAgcHVibGljIHJlYWRvbmx5IHBpcGVOYW1lOiBzdHJpbmcgO1xuICBwdWJsaWMgcmVhZG9ubHkgcGlwZUFybjogc3RyaW5nO1xuICBwdWJsaWMgcmVhZG9ubHkgcGlwZVJvbGU6IElSb2xlO1xuXG4gIGNvbnN0cnVjdG9yKHNjb3BlOiBDb25zdHJ1Y3QsIGlkOiBzdHJpbmcsIHBpcGVOYW1lOiBzdHJpbmcpIHtcbiAgICBzdXBlcihzY29wZSwgaWQpO1xuICAgIHRoaXMucGlwZU5hbWUgPSBwaXBlTmFtZTtcbiAgICB0aGlzLnBpcGVBcm4gPSBTdGFjay5vZih0aGlzKS5mb3JtYXRBcm4oe1xuICAgICAgc2VydmljZTogJ3BpcGVzJyxcbiAgICAgIHBhcnRpdGlvbjogJ2F3cycsXG4gICAgICByZXNvdXJjZTogJ3BpcGUnLFxuICAgICAgcmVzb3VyY2VOYW1lOiB0aGlzLnBpcGVOYW1lLFxuICAgIH0pO1xuICAgIHRoaXMucGlwZVJvbGUgPSBSb2xlLmZyb21Sb2xlTmFtZSh0aGlzLCAnUm9sZScsIHRoaXMucGlwZU5hbWUgKTtcbiAgfVxufVxuXG4vKipcbiAqIEFtYXpvbiBFdmVudEJyaWRnZSBQaXBlcyBjb25uZWN0cyBzb3VyY2VzIHRvIHRhcmdldHMuXG4gKlxuICogUGlwZXMgYXJlIGludGVuZGVkIGZvciBwb2ludC10by1wb2ludCBpbnRlZ3JhdGlvbnMgYmV0d2VlbiBzdXBwb3J0ZWQgc291cmNlcyBhbmQgdGFyZ2V0cyxcbiAqIHdpdGggc3VwcG9ydCBmb3IgYWR2YW5jZWQgdHJhbnNmb3JtYXRpb25zIGFuZCBlbnJpY2htZW50LlxuICpcbiAqIEBzZWUgaHR0cHM6Ly9kb2NzLmF3cy5hbWF6b24uY29tL2V2ZW50YnJpZGdlL2xhdGVzdC91c2VyZ3VpZGUvZWItcGlwZXMuaHRtbFxuICovXG5leHBvcnQgY2xhc3MgUGlwZSBleHRlbmRzIFBpcGVCYXNlIHtcbiAgLyoqXG4gICAqIENyZWF0ZXMgYSBwaXBlIGZyb20gdGhlIG5hbWUgb2YgYSBwaXBlLlxuICAgKi9cbiAgc3RhdGljIGZyb21QaXBlTmFtZShzY29wZTogQ29uc3RydWN0LCBpZDogc3RyaW5nLCBwaXBlTmFtZTogc3RyaW5nKTogSVBpcGUge1xuXG4gICAgcmV0dXJuIG5ldyBJbXBvcnRlZFBpcGUoc2NvcGUsIGlkLCBwaXBlTmFtZSk7XG4gIH1cblxuICBwdWJsaWMgcmVhZG9ubHkgcGlwZU5hbWU6IHN0cmluZztcbiAgcHVibGljIHJlYWRvbmx5IHBpcGVBcm46IHN0cmluZztcbiAgcHVibGljIHJlYWRvbmx5IHBpcGVSb2xlOiBJUm9sZTtcblxuICBjb25zdHJ1Y3RvcihzY29wZTogQ29uc3RydWN0LCBpZDogc3RyaW5nLCBwcm9wczogUGlwZVByb3BzKSB7XG5cbiAgICBzdXBlcihzY29wZSwgaWQsIHsgcGh5c2ljYWxOYW1lOiBwcm9wcy5waXBlTmFtZSB9KTtcblxuICAgIC8qKlxuICAgICAqIFJvbGUgc2V0dXBcbiAgICAgKi9cbiAgICB0aGlzLnBpcGVSb2xlID1cbiAgICAgIHByb3BzLnJvbGUgfHxcbiAgICAgIG5ldyBSb2xlKHRoaXMsICdSb2xlJywge1xuICAgICAgICBhc3N1bWVkQnk6IG5ldyBTZXJ2aWNlUHJpbmNpcGFsKCdwaXBlcy5hbWF6b25hd3MuY29tJyksXG4gICAgICB9KTtcblxuICAgIC8qKlxuICAgICAqIFNvdXJjZSAvIEZpbHRlciBzZXR1cFxuICAgICAqL1xuICAgIGNvbnN0IHNvdXJjZSA9IHByb3BzLnNvdXJjZS5iaW5kKHRoaXMpO1xuICAgIHByb3BzLnNvdXJjZS5ncmFudFJlYWQodGhpcy5waXBlUm9sZSk7XG4gICAgLy8gQWRkIHRoZSBmaWx0ZXIgY3JpdGVyaWEgdG8gdGhlIHNvdXJjZSBwYXJhbWV0ZXJzXG4gICAgY29uc3Qgc291cmNlUGFyYW1ldGVycyA6IENmblBpcGUuUGlwZVNvdXJjZVBhcmFtZXRlcnNQcm9wZXJ0eT0ge1xuICAgICAgLi4uc291cmNlLnNvdXJjZVBhcmFtZXRlcnMsXG4gICAgICBmaWx0ZXJDcml0ZXJpYTogcHJvcHMuZmlsdGVyLFxuICAgIH07XG5cbiAgICAvKipcbiAgICAgKiBFbnJpY2htZW50IHNldHVwXG4gICAgICovXG4gICAgY29uc3QgZW5yaWNobWVudCA9IHByb3BzLmVucmljaG1lbnQ/LmJpbmQodGhpcyk7XG4gICAgcHJvcHMuZW5yaWNobWVudD8uZ3JhbnRJbnZva2UodGhpcy5waXBlUm9sZSk7XG5cbiAgICAvKipcbiAgICAgKiBUYXJnZXQgc2V0dXBcbiAgICAgKi9cbiAgICBjb25zdCB0YXJnZXQgPSBwcm9wcy50YXJnZXQuYmluZCh0aGlzKTtcbiAgICBwcm9wcy50YXJnZXQuZ3JhbnRQdXNoKHRoaXMucGlwZVJvbGUpO1xuXG4gICAgLyoqXG4gICAgICogTG9ncyBzZXR1cFxuICAgICAqL1xuICAgIGNvbnN0IGluaXRpYWxMb2dDb25maWd1cmF0aW9uOiBDZm5QaXBlLlBpcGVMb2dDb25maWd1cmF0aW9uUHJvcGVydHkgPSB7XG4gICAgICBsZXZlbDogcHJvcHMubG9nTGV2ZWwgfHwgTG9nTGV2ZWwuRVJST1IsXG4gICAgICBpbmNsdWRlRXhlY3V0aW9uRGF0YTogcHJvcHMubG9nSW5jbHVkZUV4ZWN1dGlvbkRhdGEgfHwgdW5kZWZpbmVkLFxuICAgIH07XG5cbiAgICAvLyBJdGVyYXRlIG92ZXIgYWxsIHRoZSBsb2cgZGVzdGluYXRpb25zIGFuZCBhZGQgdGhlbSB0byB0aGUgbG9nIGNvbmZpZ3VyYXRpb25cbiAgICBjb25zdCBsb2dDb25maWd1cmF0aW9uID0gcHJvcHMubG9nRGVzdGluYXRpb25zPy5yZWR1Y2UoKGN1cnJlbnRMb2dDb25maWd1cmF0aW9uLCBkZXN0aW5hdGlvbikgPT4ge1xuICAgICAgY29uc3QgbG9nRGVzdGluYXRpb25Db25maWcgPSBkZXN0aW5hdGlvbi5iaW5kKHRoaXMpO1xuICAgICAgZGVzdGluYXRpb24uZ3JhbnRQdXNoKHRoaXMucGlwZVJvbGUpO1xuICAgICAgY29uc3QgYWRkaXRpb25hbExvZ0NvbmZpZ3VyYXRpb24gPSBsb2dEZXN0aW5hdGlvbkNvbmZpZy5wYXJhbWV0ZXJzO1xuICAgICAgcmV0dXJuIHsgLi4uY3VycmVudExvZ0NvbmZpZ3VyYXRpb24sIC4uLmFkZGl0aW9uYWxMb2dDb25maWd1cmF0aW9uIH07XG4gICAgfSwgaW5pdGlhbExvZ0NvbmZpZ3VyYXRpb24pO1xuXG4gICAgLyoqXG4gICAgICogUGlwZSByZXNvdXJjZVxuICAgICAqL1xuXG4gICAgY29uc3QgcmVzb3VyY2UgPSBuZXcgQ2ZuUGlwZSh0aGlzLCAnUmVzb3VyY2UnLCB7XG4gICAgICBuYW1lOiBwcm9wcy5waXBlTmFtZSxcbiAgICAgIGRlc2NyaXB0aW9uOiBwcm9wcy5kZXNjcmlwdGlvbixcbiAgICAgIHJvbGVBcm46IHRoaXMucGlwZVJvbGUucm9sZUFybixcbiAgICAgIHNvdXJjZTogcHJvcHMuc291cmNlLnNvdXJjZUFybixcbiAgICAgIHNvdXJjZVBhcmFtZXRlcnM6IHNvdXJjZVBhcmFtZXRlcnMsXG4gICAgICBlbnJpY2htZW50OiBwcm9wcy5lbnJpY2htZW50Py5lbnJpY2htZW50QXJuLFxuICAgICAgZW5yaWNobWVudFBhcmFtZXRlcnM6IGVucmljaG1lbnQ/LmVucmljaG1lbnRQYXJhbWV0ZXJzLFxuICAgICAgdGFyZ2V0OiBwcm9wcy50YXJnZXQudGFyZ2V0QXJuLFxuICAgICAgdGFyZ2V0UGFyYW1ldGVyczogdGFyZ2V0LnRhcmdldFBhcmFtZXRlcnMsXG4gICAgICBkZXNpcmVkU3RhdGU6IHByb3BzLmRlc2lyZWRTdGF0ZSxcbiAgICAgIGxvZ0NvbmZpZ3VyYXRpb246IGxvZ0NvbmZpZ3VyYXRpb24sXG4gICAgICB0YWdzOiBwcm9wcy50YWdzLFxuICAgIH0pO1xuXG4gICAgdGhpcy5waXBlTmFtZSA9IHJlc291cmNlLnJlZjtcbiAgICB0aGlzLnBpcGVBcm4gPSByZXNvdXJjZS5hdHRyQXJuO1xuICB9XG5cbn1cbiJdfQ==